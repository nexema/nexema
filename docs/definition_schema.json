{
    "$id": "https://example.com/person.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "NexemaSnapshot",
    "type": "object",
    "required": ["version", "hashcode", "files"],
    "properties": {
        "version": {
            "type": "integer",
            "description": "The nexema version used to generate the snapshot."
        },
        "hashcode": {
            "type": "integer",
            "description": "The hashcode of the snapshot."
        },
        "files": {
            "type": "array",
            "description": "List of files that need to be generated.",
            "items": { "$ref": "#/$defs/NexemaFile" }
        }
    },
    "$defs": {
        "NexemaFile": {
            "type": "object",
            "description": "Represents a Nexema definition file.",
            "required": ["id", "packageName", "path", "types"],
            "properties": {
                "id": {
                    "type": "string",
                    "description": "The id of the file."
                },
                "packageName": {
                    "type": "string",
                    "description": "The name of the package where the file is defined."
                },
                "path": {
                    "type": "string",
                    "description": "The full path to the file, relative to nexema.yaml."
                },
                "types": {
                    "type": "array",
                    "description": "The list of defined types in the file.",
                    "items": { "$ref": "#/$defs/TypeDefinition" }
                }
            }
        },
        "TypeDefinition": {
            "type": "object",
            "description": "Represents a Nexema type.",
            "required": ["id", "name", "modifier", "fields"],
            "properties": {
                "id": {
                    "type": "string",
                    "description": "The unique id of the type."
                },
                "name": {
                    "type": "string",
                    "description": "The name of the type."
                },
                "documentation": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "A list of comments defined as documentation."
                },
                "modifier": {
                    "type": "string",
                    "description": "The type's modifier: struct, union or enum."
                },
                "baseType": {
                    "type": "string",
                    "description": "The unique id of the base type, if applies."
                },
                "annotations": {
                    "type": "object",
                    "description": "A list of annotated key value pairs.",
                    "additionalProperties": true
                },
                "defaults": {
                    "type": "object",
                    "description": "The default values for the fields in the type.",
                    "additionalProperties": true
                },
                "fields": {
                    "description": "The list of fields defined in the type.",
                    "type": "array",
                    "items": { "$ref": "#/$defs/FieldDefinition" }
                }
            }
        },
        "FieldDefinition": {
            "type": "object",
            "required": ["name", "index", "type"],
            "properties": {
                "name": {
                    "description": "The name of the field.",
                    "type": "string"
                },
                "index": {
                    "description": "The index of the field.",
                    "type": "integer"
                },
                "type": {
                    "description": "The value type of the field.",
                    "oneOf": [
                        {
                            "$ref": "#/$defs/PrimitiveValueType"
                        },
                        {
                            "$ref": "#/$defs/CustomValueType"
                        }
                    ]
                },
                "documentation": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "A list of comments defined as documentation."
                },
                "annotations": {
                    "type": "object",
                    "description": "A list of annotated key value pairs.",
                    "additionalProperties": true
                }
            }
        },
        "PrimitiveValueType": {
            "type": "object",
            "description": "Defines a value type that is a Nexema primitive.",
            "required": ["primitive", "nullable"],
            "properties": {
                "primitive": {
                    "type": "string",
                    "description": "The primitive's name."
                },
                "nullable": {
                    "type": "boolean",
                    "description": "A flag that indicates if the value can be NULL."
                },
                "arguments": {
                    "type": "array",
                    "items": { 
                        "oneOf": [
                            {
                                "$ref": "#/$defs/PrimitiveValueType"
                            },
                            {
                                "$ref": "#/$defs/CustomValueType"
                            }
                        ]    
                    },
                    "description": "A list of arguments if the type is generic."
                }
            }
        },
        "CustomValueType": {
            "description": "Defines a value type that is a user defined type.",
            "type": "object",
            "required": ["nullable", "objectId"],
            "properties": {
                "objectId": {
                    "type": "string",
                    "description": "The id of the custom type."
                },
                "nullable": {
                    "type": "boolean",
                    "description": "Indicates if the value can NULL."
                }
            }
        }
    }
}